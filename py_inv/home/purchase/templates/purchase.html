{% include "base.html" %}
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

<body>
    <div class="container">
        <div class="row col-md-10 col-md-offset-2 custyle">
            <div class="card-body">
                {{error_msg | safe}}
              
                <form name="form1"  method="POST" id="FORMNAME1" enctype="multipart/form-data" class="needs-validation was-validated" novalidate>
                {% csrf_token %}
                <div class="row" style="padding:10px;">
                    <div class="col-md-12 col-sm-12 col-xs-12" >
                        <div >
                            <span style="color:red">
                                {% for invoice_no in forms %}
                                    <div class="fieldWrapper">
                                        {{ invoice_no.errors }}
                                        {% if invoice_no.help_text %}
                                        <p class="help">{{ invoice_no.help_text|safe }}</p>
                                        {% endif %}
                                    </div> 
                                {% endfor %}
                            </span>

                        </div>
                    </div>
                </div>
                
                    <div class="row" style="padding:10px;">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label id="{{forms.invoice_no.id_for_label}}"> <b>{{forms.invoice_no.label}}<i class="star"> *</i></b> </label></br>
                                {{forms.invoice_no}}
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group"><label><strong><b>Invoice Date <i class="star"> *</i></b></strong></label></br>
                                {{forms.invoice_date}}
                            </div>
                        </div>
                    </div>
                    <div class="row" style="padding:10px;">
                        <div class="col-lg-6">
                            <div class="form-group select_f"><label><strong><b>Supplier <i class="star"> </i></b></strong></label></br>
                                {{forms.supplier_id}}
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="display_supp"><strong></strong>
                                <div class="col-sm-12 col-xs-12" id="div_supplier_details"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row" style="padding:10px;">
                        <div class="col-md-12 col-sm-12 col-xs-12" align="left">
                            <table class="table table-striped custab form-group">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Item Rate</th>
                                        <th>Quantity</th>
                                        <th>Total Amt.</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tbody">
                                    <tr>
                                        <td>{{itemform.item_id}}</td>
                                        <td>{{itemform.rate}}</td>
                                        <td>{{itemform.qty}}</td>
                                        <td>{{itemform.total}}</td>
                                        <td class="ml-2">
                                            <input type="submit" name="add-btn"  class="btn btn-primary btn-sm" value="Add">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <hr>
                    
                    <div class="row" style="padding:10px;">
                        <div class="col-md-12 col-sm-12 col-xs-12" align="left">
                            <table class="table table-striped custab form-group">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Item Rate</th>
                                        <th>Quantity</th>
                                        <th>Total Amt.</th>
                                    </tr>
                                </thead>
                                {% if list %}
                                {% for value in list %}
                                    <tbody id="tbody">
                                        <tr>
                                            <td>{{value.item_name}}</td>
                                            <td>{{value.rate}}</td>
                                            <td>{{value.qty}}</td>
                                            <td>{{value.total}}</td>
                                        </tr>
                                    </tbody>
                                {% endfor %}
                                {% else %}
                                {% for data in readlist %}
                                    <tbody id="tbody">
                                        <tr>
                                            <td>{{data.item_name}}</td>
                                            <td>{{data.rate}}</td>
                                            <td>{{data.qty}}</td>
                                            <td>{{data.total}}</td>
                                        </tr>
                                    </tbody>
                                {% endfor %}
                                {% endif %}
                            </table>
                        </div>
                    </div>
                    
                    <hr>
                    <div class="row" style="padding:10px;">
                        <div class="col-md-12 col-sm-12 col-xs-12" align="left">
                            
                            <button type="submit" name="add" class="btn btn-info">{{action}}</button>
                            <a href="/purchase/purchase_list/"><span class="btn btn-info"><i class="material-icons" data-toggle="tooltip" data-original-title="{{ButtonBack}}">Back</i></span></a></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script>
   
    function getSupplier_data()
    {	
        $("#div_supplier_details").html("");
        var supplier_id=document.getElementById("id_supplier_id").value;
        //alert(supplier_id);
        $.ajax({
            type: 'POST',
            url: "/purchase/getSupplier_details/",
            data: { 'supplier_id' : supplier_id,'csrfmiddlewaretoken': '{{ csrf_token }}'},
            
            success: function(res)
            { 
                var data = JSON.parse(res);
                //console.log(data);
                //alert(data);
                document.getElementById("div_supplier_details").innerHTML = data.address + ", " + data.city + " - " + data.pincode+ "," + data.state;
            }
            
        });
   
    }

    function getItems_data()
    {	      
        var item_id=document.getElementById("id_item_id").value;
        //alert(item_id);
        $.ajax({
            type: 'POST',
            url: "/purchase/getItems_details/",
            data: { 'item_id' : item_id,'csrfmiddlewaretoken': '{{ csrf_token }}'},           
            success: function(res)
            { 
                var data = JSON.parse(res);
                //document.getElementById("id_rate").innerHTML = data.rate ;
                $("#id_rate").val(data.rate.toFixed(2));
            }          
        });  
    }


    function isNumber(evt) {
        //alert();
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }

    $( document ).ready(function() {
        //console.log( "ready!" );
        $('#id_qty').keyup(function(){
            var qyantity =  $("#id_qty").val();
            var rate =  $("#id_rate").val();
            var total = qyantity * rate;
            $("#id_total").val(total);	
    
        });
        
        $('#id_invoice_date').datepicker({ 
            startDate: '',
            autoclose: true,
            format: 'dd-mm-yyyy'
	    });

    });
    
    
    function calculate()
    {
        //alert();
        var qty=0,rate=0,total=0;
                 
        qty=parseInt($(this).find("#id_qty").val()==''?0:$(this).find("#id_qty").val());
        rate=parseInt($(this).find("#id_rate").val()==''?0:$(this).find("#id_rate").val());
        
        qty = isNaN(qty) ? 0 : qty;
        rate = isNaN(rate) ? 0 : rate;	
        
        qty_price=qty*rate;	
        total=parseInt(qty_price).toFixed(2);
        
        $("#id_total").val(total);
        
    } 

    
    </script>